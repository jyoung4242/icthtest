(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const n of s)if(n.type==="childList")for(const l of n.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&i(l)}).observe(document,{childList:!0,subtree:!0});function t(s){const n={};return s.integrity&&(n.integrity=s.integrity),s.referrerPolicy&&(n.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?n.credentials="include":s.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function i(s){if(s.ep)return;s.ep=!0;const n=t(s);fetch(s.href,n)}})();class x{constructor(){this.state="created",this.bindings=[],this.views=[],this.animations=[],this.animationQueue=[],this.destroyed="",this.moved=""}static create(e,t,i={},s={parent:null,prepare:!0,sibling:null}){const n=new x;if(n.model=i,n.element=t,n.parent=s.parent??m,t instanceof HTMLTemplateElement){const l=t.content.cloneNode(!0);if(l.children.length===1)return m.create(e,l.firstElementChild,i,s);n.views=[...l.children].map(p=>m.create(e,p,i,{...s,parent:n})),n.state="rendered"}else n.bindings.push(...m.parse(n.element,i,n,s.parent));return n.parentElement=e,n.sibling=s.sibling,n.attached=new Promise(l=>{n.attachResolve=l}),n}destroy(){this.views.forEach(e=>e.destroy()),this.element.classList.add("pui-removing"),this.destroyed="queue",m.destroyed.push(this)}terminate(){Promise.all(this.getAnimations()).then(()=>{var t;(t=this.element.parentElement)==null||t.removeChild(this.element),this.bindings.forEach(i=>i.unbind());const e=this.parent.views.findIndex(i=>i===this);e>-1&&this.parent.views.splice(e,1)}),this.destroyed="destroyed"}move(e){this.moved="queue",this.element.classList.add("pui-moving"),this.sibling=e}play(e,t){return typeof e=="string"&&(e=this.animations.find(i=>i.name===e).clone()),e.element=t,e.state="pending",this.animationQueue.push(e),this.updateAnimations(performance.now()),e}updateFromUI(){this.views.forEach(e=>e.updateFromUI()),this.bindings.forEach(e=>e.updateFromUI())}updateToUI(){var e;switch(this.views.forEach(t=>t.updateToUI()),this.bindings.forEach(t=>t.updateToUI()),this.state){case"created":this.element.classList.add("pui-adding"),this.element.hasAttribute("PUI-UNRENDERED")||(this.parentElement??m.parentElement(this.element,this.parent)).insertBefore(this.element,((e=this.sibling)==null?void 0:e.nextSibling)??null),this.attachResolve(),this.state="attaching";break;case"attaching":this.getAnimations(!1).length===0&&(this.element.classList.remove("pui-adding"),this.state="attached");break;case"attached":this.state="rendered";break}}updateAtEvents(){this.views.forEach(e=>e.updateAtEvents()),this.bindings.forEach(e=>e.updateAtEvents())}updateAnimations(e){var t;for(;((t=this.animationQueue[0])==null?void 0:t.state)==="finished";)this.animationQueue.shift().destroy();for(let i=0;i<this.animationQueue.length;i++){const s=this.animationQueue[i];s.state==="pending"&&(s.isBlocked(e)||(s.state="playing",s.startTime=e,s.animation=s.element.animate(s.keyframes,s.options),s.finished=s.animation.finished,s.finished.then(()=>{s.state="finished",this.updateAnimations(performance.now())})))}}updateMove(){switch(this.moved){case"queue":this.moved="move";break;case"move":this.getAnimations().length===0&&(m.parentElement(this.element,this.parent).insertBefore(this.element,this.sibling.nextSibling),this.element.classList.remove("pui-moving"),this.moved="",this.sibling=null);break}this.bindings.forEach(e=>e.updateMove())}getAnimations(e=!0){return this.element.getAnimations({subtree:e}).filter(t=>{var i;return t.playState!=="finished"&&((i=t.effect)==null?void 0:i.getTiming().iterations)!==1/0}).map(t=>t.finished)}}class j{constructor(){this.fromUI=!1,this.toUI=!0,this.atEvent=!1,this.oneTime=!1,this.views=[],this.firstUpdate=!0,this.events=[],this.triggerAtEvent=e=>{e.type==="change"?this.events.push(e):m.resolveValue(this.object,this.property)(e,this.object.$model,this.element,this.attribute,this.object)},this.id=++m.id}get element(){return this.$element==null&&(this.$element=typeof this.selector=="string"?this.context.querySelector(this.selector):this.selector),this.$element}set element(e){this.$element=e}static create(e){var n;const t=new j,i=((n=e.property)==null?void 0:n.split(":"))??[],s=i.shift();return t.object="$model"in e.object?e.object:{$model:e.object},t.property=s,t.arguments=i,t.context=e.context??document,t.selector=e.selector,t.attribute=e.attribute??"innerText",t.value=e.value??t.value,t.template=e.template??t.template,t.fromUI=e.fromUI??t.fromUI,t.toUI=e.toUI??t.toUI,t.atEvent=e.atEvent??t.atEvent,t.oneTime=e.oneTime??t.oneTime,t.parent=e.parent??m,t.addListener(),typeof t.fromUI!="boolean"&&(t.fromUI=t.fromUI.bind(t)),typeof t.toUI!="boolean"&&(t.toUI=t.toUI.bind(t)),t}destroy(){this.element=null,this.removeListener(),this.views.forEach(e=>e.destroy())}unbind(){m.unbind(this)}addListener(){this.atEvent&&(this.toUI=!1,this.fromUI=!1,this.element.addEventListener(this.attribute,this.triggerAtEvent))}removeListener(){this.atEvent&&this.element.removeEventListener(this.attribute,this.triggerAtEvent)}updateFromUI(){if(this.fromUI===!1||this.firstUpdate){this.firstUpdate=!1,this.views.forEach(s=>s.updateFromUI());return}const{target:e,property:t}=m.resolveProperty(this.element,this.attribute),i=e[t];if(i!==this.lastUIValue){let s=this.fromUI!==!0?this.fromUI(i,this.lastUIValue,this.property,this.object):i;if(this.lastUIValue=i,s!==void 0&&s!==this.lastValue){this.lastValue=s;const{target:n,property:l}=m.resolveProperty(this.object,this.property);m.resolveValue(this.object,this.property)==="number"&&!isNaN(s)&&(s=+s),n[l]=s}else this.lastValue=s}this.views.forEach(s=>s.updateFromUI())}updateToUI(){if(this.toUI===!1){this.views.forEach(t=>t.updateToUI());return}let e=m.resolveValue(this.object,this.property);if(this.template!=null){if(this.template instanceof HTMLElement)if(typeof this.attribute=="boolean"){if(e=(e??!1)!==!1,e!==this.lastValue){const t=this.toUI!==!0?this.toUI(e,this.lastValue,this.property,this.object,this.value):e;if(t!==void 0&&t!==this.lastUIValue){if(t===this.attribute)this.views.push(x.create(this.element.parentElement,this.template.cloneNode(!0),this.object,{parent:this,prepare:!1,sibling:this.element}));else{const i=this.views.pop();i==null||i.destroy()}this.lastValue=e,this.lastUIValue=t}}}else{let t=!1,i=!1;e==null&&(e=[]);const s=this.arguments[0],n=this.lastValue??[];if(e.length!==n.length)t=!0;else for(let o=0,w=e.length;o<w;o++){let f,u;s==null?e[o]!==n[o]&&(t=!0,i=!0):(f=m.resolveValue(e[o]??{},s),u=m.resolveValue(n[o]??{},s),f!==u&&(t=!0),e[o]!==n[o]&&(i=!0))}if(!t)if(i){const o=this.toUI!==!0?this.toUI(e,n,this.property,this.object,this.value):e;return this.updateViews(e,o)}else return this.updateViews();const l=this.toUI!==!0?this.toUI(e,n,this.property,this.object,this.value):e;if(l==null)return this.updateViews();const p=this.lastUIValue??[];let g=0;for(let o=0,w=l.length,f=0;o<w;o++,f++){let u,c;if(s==null?(u=l[o],c=p[f]):(u=m.resolveValue(l[o]??{},s),c=m.resolveValue(p[f]??{},s)),u===c)g++;else break}if(g===l.length&&l.length===p.length)return this.updateViews(e,l);const a=this.views.splice(0,g);let r=a[a.length-1];for(let o=g,w=l.length,f=g;o<w;o++,f++){const u=l[o],c=this.views.shift();if(c==null){const y={$model:{[this.attribute]:u},$parent:this.object},I=x.create(this.element.parentElement,this.template.cloneNode(!0),y,{parent:this,prepare:!1,sibling:(r==null?void 0:r.element)??this.element});a.push(I),r=I;continue}const b=s==null?u:m.resolveValue(u??{},s),h=c==null?void 0:c.model.$model[this.attribute],E=s==null?h:m.resolveValue(h??{},s);if(b===E){a.push(c),c.move((r==null?void 0:r.element)??this.element),r=c;continue}if(!l.slice(o).map(y=>s==null?y:m.resolveValue(y??{},s)).includes(E)){c.destroy(),o--,r=c;continue}this.views.unshift(c);let U=!1;for(let y=0,I=this.views.length;y<I;y++){const V=this.views[y],d=V==null?void 0:V.model.$model[this.attribute],$=s==null?d:m.resolveValue(d??{},s);if(b===$){a.push(...this.views.splice(y,1)),V.move((r==null?void 0:r.element)??this.element),U=!0,r=V;break}}if(!U){const y={$model:{[this.attribute]:u},$parent:this.object},I=x.create(this.element.parentElement,this.template.cloneNode(!0),y,{parent:this,prepare:!1,sibling:(r==null?void 0:r.element)??this.element});a.push(I),r=I}}return this.views.forEach(o=>o.destroy()),this.views=a,this.updateViews(e,l)}else if(this.value==null){const t=m.resolveValue(this.object,this.attribute),i=t.template,s=e==null?t:t.create(e);this.value=e??t,this.views.push(m.create(this.element.parentElement,i,s,{parent:this,prepare:!0,sibling:this.element}))}}else if(e!==this.lastValue){const t=this.toUI!==!0?this.toUI(e,this.lastValue,this.property,this.object,this.value):e;if(t!==void 0&&t!==this.lastUIValue){const{target:i,property:s}=m.resolveProperty(this.element,this.attribute);i[s]=t,this.lastValue=e,this.lastUIValue=t}}this.updateViews()}updateAtEvents(){let e=this.events.shift();for(;e!=null;)m.resolveValue(this.object,this.property)(e,this.object.$model,this.element,this.attribute,this.object),e=this.events.shift();this.views.forEach(t=>t.updateAtEvents())}updateMove(){this.views.forEach(e=>e.updateMove())}updateViews(e,t){e==null?this.views.forEach(i=>i.updateToUI()):(this.views.forEach((i,s)=>{const n=t[s];typeof n!="string"&&(n.$index=s),i.model.$model[this.attribute]=n,i.updateToUI()}),this.lastValue=[...e],this.lastUIValue=[...t]),this.oneTime&&(this.toUI=!1,this.fromUI=!1)}}class v{static initialize(e=!0){if(this.initialized=!0,e!==!1){if(e===!0){const t=()=>{this.update(),requestAnimationFrame(t)};requestAnimationFrame(t);return}setInterval(()=>this.update(),1e3/e)}}static create(e,t,i={},s={parent:null,prepare:!0,sibling:null}){if(typeof t=="string"){const l=(e==null?void 0:e.ownerDocument)??document;if(t.startsWith("#"))t=l.querySelector(t);else{const p=l.createElement("template");p.innerHTML=s.prepare?this.prepare(t):t,t=p}}const n=x.create(e,t,i,s);return n.parent===m&&this.views.push(n),this.initialized||this.initialize(),n}static play(e,t){return typeof e=="string"?(e=this.globals.animations.find(i=>i.name===e).clone(),e.play(t)):e.play()}static queue(e){this.t.push(e)}static register(e,t){this.registrations[e]=t}static parse(e,t,i,s){const n=[];if(e.nodeType===3){let l=e.textContent,p=l.match(this.regexValue);for(;p!=null;){const g=p[1];let a=p[2];l=p[3];let r=!1;a.startsWith("|")&&(r=!0,a=a.slice(1).trimStart());const o=a.match(this.regexConditionalValue);let w,f=!0;o&&(a=o[3],w=`${o[2]}${o[1]}`,f=function(c,b,h,E,U){const y=U[0]==="=";return U=U.slice(2,-1),!!c===y?U:""});let u=e.cloneNode();e.textContent=g,this.parentElement(e,s).insertBefore(u,e.nextSibling),n.push(this.bind({selector:u,attribute:"textContent",object:t,property:a,parent:i,oneTime:r,value:w,toUI:f})),e=u,u=e.cloneNode(),u.textContent=l,this.parentElement(e,s).insertBefore(u,e.nextSibling),e=u,p=l.match(this.regexValue)}}else{const l=e.getAttribute("pui")??"";if(l.trim().length>0){const p=l.split(";");for(let g of p)g=g.trim(),g.length>0&&e.setAttribute(`pui.${this.bindingCounter++}`,g)}if(e.removeAttribute("pui"),n.push(...Object.keys(e.attributes??[]).reverse().map(p=>{const g=[];if(e instanceof Comment)return[];const a=e.attributes[p];if(a.name.startsWith("pui.")){const f=a.value.match(this.regexAttribute);let[u,c,b,h,E]=f,U,y,I=!1;if(b!=="@"){const V=c.match(/^'(.*?)'$/);if(V!=null)U=V[1],e.setAttribute("value",U),c=e.nodeName.toLowerCase()==="option"?"selected":"checked",h=d=>d?U:void 0,b=d=>d===U;else if(c==="")if(h===">"){const{target:d,property:$}=this.resolveProperty(t,E);return d[$]=e,[]}else{const d=document.createComment(a.name);this.parentNode(e,s).insertBefore(d,e),this.parentNode(e,s).removeChild(e),e.removeAttribute(a.name),y=e,e=d,c=b==="=",b=!0,h==="|"&&(I=!0)}else if(h==="="&&b==="="){e.setAttribute("pui-unrendered","");const d=this.parentNode(e,s);if(d.nodeType!==8){const $=document.createComment(a.name);d.insertBefore($,e),d.removeChild(e),e.removeAttribute(a.name),e=$}else e=d;y=c,I=!0,b=!0}else if(h==="*"){const d=document.createComment(a.name);this.parentNode(e,s).insertBefore(d,e),this.parentNode(e,s).removeChild(e),e.removeAttribute(a.name),y=e,e=d}else h==="|"?I=!0:c!=="checked"&&e.setAttribute(c,"")}return[this.bind({selector:e,attribute:c,value:U,object:t,property:E,template:y,toUI:typeof b=="string"?b==="<":b,fromUI:typeof h=="string"?h===">":h,atEvent:b==="@",parent:i,oneTime:I})]}const r=[a.value];let o=0,w=r[o].match(this.regexValue);for(;w!=null;){let{before:f,property:u,after:c}=w.groups,b=!1;u.startsWith("|")&&(b=!0,u=u.slice(1).trimStart());const h=u.match(this.regexConditionalValue);let E;h&&(u=h[3],E=`${h[2]}${h[1]}`),g.push(this.bind({selector:e,attribute:a.name,object:t,property:u,oneTime:b,toUI(U,y,I,V,d){if(this.oneTime){const A=r.indexOf(I);A>-1&&(r[A]=v.resolveValue(V,I),r[A-1]+=r[A]+r[A+1],r.splice(A,2))}const $=r.map((A,T)=>{if(T%2===0)return A;const C=A.match(v.regexSplitConditionalValue);if(C){const N=A===`${I}${d}`?U:v.resolveValue(V,C[1]),L=C[2]==="=";return!!N===L?C[3].slice(1,-1):""}return A===I?U:v.resolveValue(V,A)}).join("");return e.setAttribute(a.name,$),$},parent:i,value:E})),r[o++]=f,r[o++]=`${u}${E??""}`,r[o]=c,w=r[o].match(this.regexValue)}return g}).flat()),e instanceof Comment)return n.filter(p=>p.template!=null?!0:(p.unbind(),!1));if(!this.leaveAttributes)for(let p=Object.keys(e.attributes??[]).length-1;p>=0;p--){const g=e.attributes[Object.keys(e.attributes??[])[p]];g.name.startsWith("pui.")&&e.removeAttribute(g.name)}n.push(...Array.from(e.childNodes).map(p=>this.parse(p,t,i,s)).flat())}return n}static bind(e){return j.create(e)}static unbind(e){if(e.destroy(),e.parent!==m){const t=e.parent.bindings,i=t.indexOf(e);i>-1&&t.splice(i,1)}}static update(){this.i.forEach(t=>t()),this.i=this.t,this.t=[],this.views.forEach(t=>t.updateFromUI()),this.views.forEach(t=>t.updateToUI()),this.views.forEach(t=>t.updateAtEvents());const e=performance.now();[...this.views,this.globals].forEach(t=>t.updateAnimations(e)),this.views.forEach(t=>{t.updateMove()}),this.destroyed.forEach(t=>{switch(t.destroyed){case"queue":t.state==="rendered"?t.destroyed="destroy":t.updateToUI();break;case"destroy":{t.terminate();const i=this.destroyed.findIndex(s=>t===s);i>-1&&this.destroyed.splice(i,1)}}})}static resolveProperty(e,t){t=t.replace("[",".").replace("]",".");const i=t.split(".").filter(n=>(n??"").length>0);for(;i[0]==="$parent"&&e.$parent!=null;)e=e.$parent,i.shift();let s="$model"in e?e.$model:e;for(;i.length>1;)s=s[i.shift()];return{target:s,property:i[0]}}static resolveValue(e,t){let i=0;do{const{target:s,property:n}=this.resolveProperty(e,t);if(s!=null&&n in s)return s[n];e=e.$parent}while(e!=null&&i++<1e3);if(t in this.registrations)return this.registrations[t]}static parentElement(e,t){const i=e.parentElement;if(i!=null)return i;for(;t!=null&&(t.element==null||t.element===e);)t=t.parent;return t==null?void 0:t.element}static parentNode(e,t){const i=e.parentNode;if(i!=null)return i;for(;t!=null&&(t.element==null||t.element===e);)t=t.parent;return t==null?void 0:t.element}static prepare(e){let t=e;e="";let i=t.match(this.regexReplace);for(;i!=null;){const[s,n,l,p]=i;l.match(/\S\s*===/)?e+=`${n.trimEnd()}br PUI.${this.bindingCounter++}="${l}"`:e+=`${n} PUI.${this.bindingCounter++}="${l}" `,t=p,i=t.match(this.regexReplace)}return e+=t,e}static parseAttribute(e,t,i,s,n,l){const p=l.match(this.regexAttribute);let[g,a,r,o,w]=p,f,u,c=!1;if(r!=="@"){const b=a.match(/^'(.*?)'$/);if(b!=null)f=b[1],e.setAttribute("value",f),a=e.nodeName.toLowerCase()==="option"?"selected":"checked",o=h=>h?f:void 0,r=h=>h===f;else if(a==="")if(o===">"){const{target:h,property:E}=this.resolveProperty(t,w);return h[E]=e,[]}else{const h=document.createComment(n);this.parentNode(e,s).insertBefore(h,e),this.parentNode(e,s).removeChild(e),e.removeAttribute(n),u=e,e=h,a=r==="=",r=!0,o==="|"&&(c=!0)}else if(o==="="&&r==="="){const h=this.parentNode(e,s);if(h.nodeType!==8){const E=document.createComment(n);h.insertBefore(E,e),h.removeChild(e),e.removeAttribute(n),e=E}else e=h;u=a,c=!0,r=!0}else if(o==="*"){const h=document.createComment(n);this.parentNode(e,s).insertBefore(h,e),this.parentNode(e,s).removeChild(e),e.removeAttribute(n),u=e,e=h}else o==="|"?c=!0:a!=="checked"&&e.setAttribute(a,"")}return[this.bind({selector:e,attribute:a,value:f,object:t,property:w,template:u,toUI:typeof r=="string"?r==="<":r,fromUI:typeof o=="string"?o===">":o,atEvent:r==="@",parent:i,oneTime:c})]}}v.initialized=!1;v.id=0;v.views=[];v.destroyed=[];v.globals=new x;v.registrations={};v.leaveAttributes=!1;v.regexReplace=/([\S\s]*?)\\?\$\{([^}]*?[<=@!]=[*=>|][^}]*?)\}([\S\s]*)/m;v.regexAttribute=/^\s*(\S*?)\s*([<=@!])=([*=>|])\s*(\S*?)\s*$/;v.regexValue=/(?<before>[\S\s]*?)\\?\$\{\s*(?<property>[\s\S]*?)\s*\}(?<after>[\S\s]*)/m;v.regexConditionalValue=/^\s*(.+?)\s*([=!])\s*(\S+)/;v.regexSplitConditionalValue=/^(.+?)([=!])(.*)/;v.bindingCounter=0;v.i=[];v.t=[];"UI"in top||(top.UI=v);const m=top.UI,S={},P="<div> Hello Peasy!!! </div>";m.create(document.body,P,S);console.log("Hello World");
